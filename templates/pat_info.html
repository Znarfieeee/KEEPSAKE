{% extends 'base.html' %}
{% block content %}
    <div class="information-container">
        <div class="patient-header">
            <div class="patient-info">
                <a href="{{ url_for('index') }}" class="btn btn-link">
                    <img style="height: 25px; width:auto;" src="/static/images/back.png">
                </a>
                <h1 style="margin-left: 10px;">{{ patient['PT_FNAME'] }} {{patient['PT_LNAME']}}</h1>
            </div>
            <div class="action-btn">
                <button class="edit-btn" onclick="editPatient()">EDIT</button>
                <button class="deactivate-btn" onclick="deactivatePatient('{{ patient.PT_ID }}')">DEACTIVATE</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="active" id="information">INFORMATION</button>
            <button id="immunization">IMMUNIZATION</button>
            <button id="prescription">PRESCRIPTION</button>
        </div>

        <div class="tab-content">
            <div class="pt-info">
                <div class="pat-detail-title">PATIENT'S INFORMATION</div>
                <div class="info-grid">
                    <div>
                        <div class="label">LAST NAME</div>
                        <div class="value">{{ patient['PT_LNAME'] }}</div>
                    </div>
                    <div>
                        <div class="label">FIRST NAME</div>
                        <div class="value">{{ patient['PT_FNAME'] }}</div>
                    </div>
                    <div>
                        <div class="label">MIDDLE NAME</div>
                        <div class="value">{{ patient['PT_MNAME'] }}</div>
                    </div>
                    <div>
                        <div class="label">AGE</div>
                        <div class="value">{{age}}</div>
                    </div>
                    <div>
                        <div class="label">BIRTHDATE</div>
                        <div class="value">{{ patient['DT_OF_BIRTH'] }}</div>
                    </div>
                </div>
            </div>

            <div class="contact-info">
                <div class="pat-detail-title">CONTACT DETAILS</div>
                <div class="info-grid">
                    <div>
                        <div class="label">MOTHER'S NAME</div>
                        <div class="value">{{ patient['MT_NAME'] }}</div>
                    </div>
                    <div>
                        <div class="label">FATHER'S NAME</div>
                        <div class="value">{{ patient['FT_NAME'] }}</div>
                    </div>
                    <div>
                        <div class="label">CONTACT NUMBER</div>
                        <div class="value">{{ patient['CON_NUM'] }}</div>
                    </div>
                    <div>
                        <div class="label">EMAIL</div>
                        <div class="value">{{ patient['EMAIL_ADD'] }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="editPatientModal" class="w3-modal">
        <form action="/editpatient" method="POST" class="w3-modal-content w3-card-4 w3-round-xlarge" style="width: 50%;">
            <header class="w3-container">
                <h2>Edit Patient</h2>
            </header>
            <div class="w3-container">
                <input type="hidden" id="pt_id" name="pt_id" value="{{ patient.PT_ID }}">
                <p>
                    <label>Last Name</label>
                    <input class="w3-input" type="text" id="edit_pt_lname" name="pt_lname" value="{{ patient['PT_LNAME'] }}">
                </p>
                <p>
                    <label>First Name</label>
                    <input class="w3-input" type="text" id="edit_pt_fname" name="pt_fname" value="{{ patient['PT_FNAME'] }}">
                </p>
                <p>
                    <label>Middle Name</label>
                    <input class="w3-input" type="text" id="edit_pt_mname" name="pt_mname" value="{{ patient['PT_MNAME'] }}">
                </p>
                <p>
                    <label>Birthdate</label>
                    <input class="w3-input" type="date" id="edit_dt_of_birth" name="dt_of_birth" value="{{ patient['DT_OF_BIRTH'] }}">
                </p>
                <p>
                    <label>Mother's Name</label>
                    <input class="w3-input" type="text" id="edit_mt_name" name="mt_name" value="{{ patient['MT_NAME'] }}">
                </p>
                <p>
                    <label>Father's Name</label>
                    <input class="w3-input" type="text" id="edit_ft_name" name="ft_name" value="{{ patient['FT_NAME'] }}">
                </p>
                <p>
                    <label>Contact Number</label>
                    <input class="w3-input" type="text" id="edit_con_num" name="con_num" value="{{ patient['CON_NUM'] }}">
                </p>
                <p>
                    <label>Email</label>
                    <input class="w3-input" type="email" id="edit_email_add" name="email_add" value="{{ patient['EMAIL_ADD'] if patient['EMAIL_ADD'] else '' }}">
                </p>
                <div class="w3-center ad">
                    <button type="button" onclick="closeEditModal()" class="modalcancel">Cancel</button>
                    <button type="submit" class="modaladd">Save</button>
                </div>
            </div>
        </form>
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">
                        <span>{{ message }}</span>
                        <!-- <button onclick="this.parentElement.style.display='none';">OK</button> -->
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    <script>
        
        function editPatient() {

            document.getElementById('editPatientModal').style.display = 'block';
        }
        function closeEditModal() {
            document.getElementById('editPatientModal').style.display = 'none';
        }

        function deactivatePatient(pt_id) {
            if (confirm('Are you sure you want to deactivate this patient?')) {
                fetch('/deactivatepatient', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `pt_id=${encodeURIComponent(pt_id)}`
                })
                .then(response => {
                    if (response.redirected) {
                        window.location.href = response.url;
                    } else {
                        alert('An error occurred while deactivating the patient.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deactivating the patient.');
                });
            }
        }

        function active() {
        }
    </script>
{% endblock %}
